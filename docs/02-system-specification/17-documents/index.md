---
title: 帳票出力機能
---

# 帳票出力機能

## 概要

公式書類（出席証明書、長期休暇証明書、入管届出書類など）をプロンプトベースで出力する機能。
従来の「画面を何階層も辿って、対象者を選んで、ボタンを押す」操作を、「Aの学生の出席証明出して」の一言で完了させる。

[システムコンセプト](../00-concept/index.md) の「人間の入力を最小化する」を帳票出力で実現する。

## チャットボット機能との違い

| | チャットボット（データ照会・出力） | 帳票出力 |
|---|---|---|
| **出力内容** | 生データの表・リスト | 書式が決まった公式書類 |
| **テンプレート** | なし（その場で整形） | あり（DBに保存された書式） |
| **出力形式** | 画面表示 + CSV/Excel | PDF / Excel（選択可能） |
| **例** | 「未納者一覧」「出席率80%以下の学生」 | 「出席証明書」「長期休暇証明書」「離脱届」 |

## 2つのモード

### 出力モード

テンプレート（書式）+ DBのデータ → PDF/Excel を生成する。

```
User: 「田中太郎さんの出席証明書を出して」
  ↓
システム: テンプレート「出席証明書」を選択
        + Student テーブルから田中太郎の情報を取得
        + AttendanceRecord から出席データを取得
        → PDF を生成してダウンロードリンクを表示
```

### 修正モード

テンプレートの書式変更・新規作成を行う。**必ず決裁が必要。**

```
User: 「長期休暇証明書の期間を2026年7月20日〜8月31日に変えて」
  ↓
システム: テンプレートの変更内容を解釈 → 確認画面 → 決裁申請
  ↓
決裁者: 承認後 → テンプレート（DB）が更新される
```

新規作成の例:
```
User: 「卒業証明書のテンプレートを作って。学生名、生年月日、在籍期間、卒業日を含めて」
  ↓
システム: テンプレートを生成 → 確認画面 → 決裁申請
  ↓
決裁者: 承認後 → 新しいテンプレートがDBに追加される
```

## 出力形式

帳票の種類に応じて PDF / Excel を選択できる。

| 帳票の種類 | 推奨形式 | 理由 |
|-----------|---------|------|
| 証明書系（出席証明、在籍証明など） | PDF | 印刷してそのまま提出 |
| 入管届出書類 | PDF | 公式書式に準拠 |
| 一覧表・報告書 | Excel | 手動で微調整が必要な場合がある |

## テンプレート管理

テンプレートは DB に保存する。プロンプトで書式変更・新規作成ができ、コードの変更やデプロイは不要。

テンプレートに含まれる情報:
- **名前**: テンプレートの識別名（例: 出席証明書）
- **カテゴリ**: 分類（証明書、入管書類、社内文書など）
- **レイアウト定義**: HTML + CSS ベースの書式
- **差し込みフィールド**: DBから取得するデータの定義（学生名、出席率など）
- **出力形式**: PDF / Excel / 選択可能
- **バージョン**: 変更履歴を管理

## 決裁フロー

| 操作 | 決裁 |
|------|------|
| 帳票の出力 | データ変更と同じフロー（決裁者がいれば承認、いなければ即実行） |
| テンプレートの書式変更 | **必ず決裁が必要**（公式書類の書式変更は影響が大きい） |
| テンプレートの新規作成 | **必ず決裁が必要** |

## 認証・権限

チャットボット機能と同じ3ロール体系を使用する。

| ロール | 帳票出力 | テンプレート修正 | 決裁 |
|--------|:---:|:---:|:---:|
| **一般ユーザー** | OK | NG | NG |
| **管理者** | OK | 申請のみ | NG |
| **決裁者** | OK | 申請のみ | OK |

## 想定する帳票一覧（初期）

| # | 帳票名 | カテゴリ | 出力形式 | データソース |
|---|--------|---------|---------|-------------|
| 1 | 出席成績証明書 | 証明書 | PDF | Student + AttendanceRecord + Certification |
| 2 | 在籍証明書 | 証明書 | PDF | Student + Class |
| 3 | 長期休暇証明書 | 証明書 | PDF | Student（+ 期間パラメータ） |
| 4 | 卒業証明書 | 証明書 | PDF | Student |
| 5 | 離脱届 | 入管書類 | PDF | Student + ImmigrationTask |
| 6 | 在籍者数報告 | 入管書類 | Excel | Student（集計） |
| 7 | 定期報告 | 入管書類 | Excel | Student + AttendanceRecord（集計） |

※ 運用しながらテンプレートを追加していく。
