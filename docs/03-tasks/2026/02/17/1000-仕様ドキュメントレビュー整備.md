---
title: 仕様ドキュメントレビュー・整備（全13カテゴリ）
status: 完了
---

# 仕様ドキュメントレビュー・整備（全13カテゴリ）

## 参照ドキュメント

- 仕様: `docs/02-system-specification/` 配下の全13カテゴリ
- 業務ナレッジ: `docs/01-domain-knowledge/` 配下の対応カテゴリ
- 引き継ぎ元: `HANDOVER_joshinan-docs_20260216.md`

## 確認事項

- 全13カテゴリの entity + uiux をサブエージェントで一括作成済み
- 業務知識との整合性をユーザーが確認する必要がある
- 特に FK 関係、Enum 値、画面遷移の妥当性が要チェック

## 実装項目

### 01-school-info（学校基本情報）

- [x] `docs/02-system-specification/01-school-info/01-entity.md` — エンティティ定義（School, EnrollmentPeriod）のレビュー
- [x] `docs/02-system-specification/01-school-info/02-uiux.md` — 画面定義（学校設定、入学時期設定）のレビュー
- [x] `docs/01-domain-knowledge/01-school-info/02-data.md` との整合性確認

### 02-student-management（学生管理）

- [x] `docs/02-system-specification/02-student-management/01-entity.md` — エンティティ定義（Student, StudentEmployment, InterviewRecord）のレビュー
- [x] `docs/02-system-specification/02-student-management/02-uiux.md` — 画面定義（学生一覧/詳細/登録、面談記録）のレビュー
- [x] `docs/01-domain-knowledge/02-student-management/02-data.md` との整合性確認
- [x] 課題確認: agentId・withdrawalDate の「上書き禁止」ルールと UIUX 側の変更フローの整合

### 03-curriculum（カリキュラム・時間割）

- [x] `docs/02-system-specification/03-curriculum/01-entity.md` — エンティティ定義（Course, Subject, Period, TimetableSlot）のレビュー
- [x] `docs/02-system-specification/03-curriculum/02-uiux.md` — 画面定義（コース管理、時間割編集、時限設定）のレビュー
- [x] `docs/01-domain-knowledge/03-curriculum/02-data.md` との整合性確認
- [x] 課題確認: 教員重複チェックが「警告のみ」で問題ないか

### 04-class-assignment（クラス編成）

- [x] `docs/02-system-specification/04-class-assignment/01-entity.md` — エンティティ定義（Class, ClassEnrollment）のレビュー
- [x] `docs/02-system-specification/04-class-assignment/02-uiux.md` — 画面定義（クラス一覧/詳細/登録、学生割当）のレビュー
- [x] `docs/01-domain-knowledge/04-class-assignment/02-data.md` との整合性確認

### 05-attendance（出席管理）

- [x] `docs/02-system-specification/05-attendance/01-entity.md` — エンティティ定義（AttendanceRecord, MonthlyAttendanceRate, SemiannualAttendanceReport）のレビュー
- [x] `docs/02-system-specification/05-attendance/02-uiux.md` — 画面定義（出席ダッシュボード、出欠入力、学生別出席率）のレビュー
- [x] `docs/01-domain-knowledge/05-attendance/02-data.md` との整合性確認

### 06-tuition（学費管理）

- [x] `docs/02-system-specification/06-tuition/01-entity.md` — エンティティ定義（BillingItem, Invoice, Payment, MonthlyBalance）のレビュー
- [x] `docs/02-system-specification/06-tuition/02-uiux.md` — 画面定義（学費ダッシュボード、残高管理、請求/入金、経理表）のレビュー
- [x] `docs/01-domain-knowledge/06-tuition/02-data.md` との整合性確認
- [x] 課題確認: 3月・8月の請求生成スキップの仕組み（月別請求テーブルの実体）

### 07-agent-management（エージェント管理）

- [x] `docs/02-system-specification/07-agent-management/01-entity.md` — エンティティ定義（Agent, AgentAlias, AgentInvoice, AgentPayment）のレビュー
- [x] `docs/02-system-specification/07-agent-management/02-uiux.md` — 画面定義（エージェント管理、請求書/支払い管理）のレビュー
- [x] `docs/01-domain-knowledge/07-agent-management/02-data.md` との整合性確認

### 08-facility-management（施設・備品管理）

- [x] `docs/02-system-specification/08-facility-management/01-entity.md` — エンティティ定義（Dormitory, DormitoryAssignment, DormitoryUtility, WifiDevice）のレビュー
- [x] `docs/02-system-specification/08-facility-management/02-uiux.md` — 画面定義（物件管理、水光熱費、WiFiデバイス）のレビュー
- [x] `docs/01-domain-knowledge/08-facility-management/02-data.md` との整合性確認
- [x] 課題確認: WifiDevice の詳細画面が UIUX に不足している件

### 09-staff-management（教職員管理）

- [x] `docs/02-system-specification/09-staff-management/01-entity.md` — エンティティ定義（Staff, TeacherQualification）のレビュー
- [x] `docs/02-system-specification/09-staff-management/02-uiux.md` — 画面定義（教職員管理、配置管理）のレビュー
- [x] `docs/01-domain-knowledge/09-staff-management/02-data.md` との整合性確認

### 11-immigration-report（入管報告・届出）

- [x] `docs/02-system-specification/11-immigration-report/01-entity.md` — エンティティ定義（ImmigrationTask, ImmigrationDocument, ScheduledReport）のレビュー
- [x] `docs/02-system-specification/11-immigration-report/02-uiux.md` — 画面定義（タスクダッシュボード、定期報告、ビザ更新管理）のレビュー
- [x] `docs/01-domain-knowledge/11-immigration-report/02-data.md` との整合性確認

### 12-internal-documents（社内文書）

- [x] `docs/02-system-specification/12-internal-documents/01-entity.md` — エンティティ定義（DocumentTemplate, GeneratedDocument）のレビュー
- [x] `docs/02-system-specification/12-internal-documents/02-uiux.md` — 画面定義（テンプレート管理、文書生成、生成履歴）のレビュー
- [x] `docs/01-domain-knowledge/12-internal-documents/02-data.md` との整合性確認
- [x] 課題確認: 動的フォームの設計が薄いため詳細化が必要か判断

### 14-recruitment（募集業務）

- [x] `docs/02-system-specification/14-recruitment/01-entity.md` — エンティティ定義（RecruitmentCycle, ApplicationCase, ApplicationDocument, DocumentCheckResult）のレビュー
- [x] `docs/02-system-specification/14-recruitment/02-uiux.md` — 画面定義（募集ダッシュボード、申請ケース管理、書類管理）のレビュー
- [x] `docs/01-domain-knowledge/14-recruitment/02-data.md` との整合性確認
- [x] 課題確認: ApplicationCase → Student の逆参照が 02-student-management 側に未記載
- [x] 課題確認: DocumentType の CHECKLIST が複数書類を含む点の明確化

### 15-specified-skilled-worker（特定技能・職業紹介）

- [x] `docs/02-system-specification/15-specified-skilled-worker/01-entity.md` — エンティティ定義（JobPosting, JobMatch, SupportPlan）のレビュー
- [x] `docs/02-system-specification/15-specified-skilled-worker/02-uiux.md` — 画面定義（求人管理、マッチング管理、支援計画）のレビュー
- [x] `docs/01-domain-knowledge/15-specified-skilled-worker/02-data.md` との整合性確認
- [x] 課題確認: 「将来的な拡張領域」として簡易設計のままでよいか判断

### 横断的な課題

- [x] カテゴリ間 FK の相互参照確認（Student↔Agent, Student↔Staff, ApplicationCase↔Student）
- [x] Enum 定義の重複チェック（EnrollmentMonth が 01-school-info と 14-recruitment で別定義）
- [x] 全カテゴリの entity に共通の監査フィールド（createdAt, updatedAt, createdBy, updatedBy）が定義されているか確認

### 検証

- [x] `npm run build` — VitePress ビルドが通ることを確認

## 申送事項

### 全カテゴリ共通の修正

- **createdById / updatedById 追加**: 全13カテゴリの全エンティティに監査フィールド（FK → Staff）を追加済み
- **updatedAt 追加**: MonthlyAttendanceRate, SemiannualAttendanceReport, MonthlyBalance, DormitoryAssignment, ScheduledReport, AgentAlias に欠落していた updatedAt を追加済み

### カテゴリ別の主要修正

| カテゴリ | 修正内容 |
|---------|---------|
| 02-student | UIUX に資格証タブ追加、エージェント/退学情報/備考の表示位置明記 |
| 03-curriculum | data.md の Course セクション整理（独立エンティティとしない旨を注記）、Subject に description/isActive 追加 |
| 05-attendance | AttendanceAlertLevel に CAUTION（70%ライン）追加、EARLY_LEAVE の出席率ルール明記 |
| 06-tuition | Invoice に複合ユニーク制約追加、月別請求テーブルの設計方針注記、入金消込の設計メモ追加 |
| 07-agent | UIUX にエージェント編集画面追加、登録フォームに備考追加 |
| 08-facility | WiFiデバイスの UIUX 詳細定義追加、物件登録フォーム定義追加 |
| 09-staff | data.md の「週間コマ数」を「上限」に修正、TeacherQualification に備考追加 |
| 11-immigration | タスク種別ごとの studentId 必須/任意ルール追加 |
| 12-internal-documents | DocumentTemplate に slug 追加、GeneratedDocument に fileName 追加、動的フォームのテンプレート別定義追加 |
| 14-recruitment | CHECKLIST の運用方針明記、ApplicationCase → Student の逆参照メモ追加 |
| 15-ssw | data.md の Company 定義整理、SswCase に複合ユニーク制約追加 |

### コード修正

| ファイル | 修正内容 |
|---------|---------|
| apps/web/tsconfig.json | exclude に __tests__ と vitest.config.ts を追加（TS エラー解消） |
| apps/web/app/api/agents/[id]/aliases/route.ts | ok({ error: ... }) → errorResponse() に修正 |
| apps/web/app/api/staff/route.ts | isActive フィルタに空文字チェック追加（パターン統一） |

### 今後の課題（未対応）

- Prisma スキーマへの createdById/updatedById 追加（テーブル変更を伴うため、実装フェーズで対応）
- AttendanceTerm の VO（domain パッケージ）が未作成
- /api/staffs と /api/staff の命名重複の解消
- 300行超のページコンポーネントの分割（classes/[id], timetable, subjects 等）
- 採番処理のレースコンディション対策
