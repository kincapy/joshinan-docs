/// =============================================
/// 教職員管理 (09-staff-management)
/// =============================================

/// 役職
enum StaffRole {
  PRINCIPAL            /// 校長
  HEAD_TEACHER         /// 教務主任
  FULL_TIME_TEACHER    /// 常勤講師
  PART_TIME_TEACHER    /// 非常勤講師
  LIFE_COUNSELOR       /// 生活指導員
  ADMINISTRATIVE_STAFF /// 事務担当
  MANAGEMENT           /// 経営者
}

/// 雇用形態
enum EmploymentType {
  FULL_TIME /// 常勤
  PART_TIME /// 非常勤
  CONTRACT  /// パート
}

/// 給与形態
enum PayType {
  MONTHLY_SALARY /// 月給
  HOURLY_WAGE    /// 時給+授業手当
  PER_LESSON     /// コマ給
}

/// 資格種別
enum QualificationType {
  MAJOR              /// 主専攻（日本語教育を主専攻として大学・大学院卒）
  MINOR              /// 副専攻（日本語教育を副専攻として大学・大学院卒）
  TRAINING_420H      /// 420時間養成講座
  CERTIFICATION_EXAM /// 検定合格（日本語教育能力検定試験）
  REGISTERED_TEACHER /// 登録日本語教師（国家資格）
}

/// 教職員
model Staff {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  /// 氏名
  name             String
  /// メールアドレス
  email            String?         @unique
  /// 電話番号
  phone            String?
  /// 役職
  role             StaffRole
  /// 雇用形態
  employmentType   EmploymentType
  /// 入社日
  hireDate         DateTime        @db.Date
  /// 退職日
  resignationDate  DateTime?       @db.Date
  /// 給与形態（非常勤の場合に設定）
  payType          PayType?
  /// 週間コマ数上限（常勤: 25、非常勤: null）
  maxWeeklyLessons Int?
  /// 有効フラグ（退職時に false）
  isActive         Boolean         @default(true)
  /// ユーザーロール（チャットボット・プロジェクト機能の権限）
  userRole         UserRole        @default(GENERAL)
  /// 作成者スタッフID
  createdById      String?         @db.Uuid
  /// 更新者スタッフID
  updatedById      String?         @db.Uuid
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  /// 作成者（自己参照）
  createdBy Staff? @relation("StaffCreatedBy", fields: [createdById], references: [id], onDelete: Restrict)
  /// 更新者（自己参照）
  updatedBy Staff? @relation("StaffUpdatedBy", fields: [updatedById], references: [id], onDelete: Restrict)
  /// 自身が作成した Staff レコード
  createdStaffs Staff[] @relation("StaffCreatedBy")
  /// 自身が更新した Staff レコード
  updatedStaffs Staff[] @relation("StaffUpdatedBy")

  /// 保有資格 (1:N)
  qualifications     TeacherQualification[]
  /// 担当時間割枠 (1:N)
  timetableSlots     TimetableSlot[]
  /// 作成した文書 (1:N)
  generatedDocuments GeneratedDocument[]
  /// 担当した面談 (1:N)
  interviewRecords   InterviewRecord[]
  /// 出迎え担当の学生 (1:N)
  pickupStudents     Student[]              @relation("PickupStaff")

  /// --- 監査フィールド逆リレーション ---
  /// School
  createdSchools              School[]              @relation("SchoolCreatedBy")
  updatedSchools              School[]              @relation("SchoolUpdatedBy")
  /// EnrollmentPeriod
  createdEnrollmentPeriods    EnrollmentPeriod[]    @relation("EnrollmentPeriodCreatedBy")
  updatedEnrollmentPeriods    EnrollmentPeriod[]    @relation("EnrollmentPeriodUpdatedBy")
  /// TeacherQualification
  createdTeacherQualifications TeacherQualification[] @relation("TeacherQualificationCreatedBy")
  updatedTeacherQualifications TeacherQualification[] @relation("TeacherQualificationUpdatedBy")
  /// Student
  createdStudents             Student[]             @relation("StudentCreatedBy")
  updatedStudents             Student[]             @relation("StudentUpdatedBy")
  /// StudentEmployment
  createdStudentEmployments   StudentEmployment[]   @relation("StudentEmploymentCreatedBy")
  updatedStudentEmployments   StudentEmployment[]   @relation("StudentEmploymentUpdatedBy")
  /// InterviewRecord
  createdInterviewRecords     InterviewRecord[]     @relation("InterviewRecordCreatedBy")
  updatedInterviewRecords     InterviewRecord[]     @relation("InterviewRecordUpdatedBy")
  /// StudentCertification
  createdStudentCertifications StudentCertification[] @relation("StudentCertificationCreatedBy")
  updatedStudentCertifications StudentCertification[] @relation("StudentCertificationUpdatedBy")
  /// Class
  createdClasses              Class[]               @relation("ClassCreatedBy")
  updatedClasses              Class[]               @relation("ClassUpdatedBy")
  /// ClassEnrollment
  createdClassEnrollments     ClassEnrollment[]     @relation("ClassEnrollmentCreatedBy")
  updatedClassEnrollments     ClassEnrollment[]     @relation("ClassEnrollmentUpdatedBy")
  /// Subject
  createdSubjects             Subject[]             @relation("SubjectCreatedBy")
  updatedSubjects             Subject[]             @relation("SubjectUpdatedBy")
  /// Period
  createdPeriods              Period[]              @relation("PeriodCreatedBy")
  updatedPeriods              Period[]              @relation("PeriodUpdatedBy")
  /// TimetableSlot
  createdTimetableSlots       TimetableSlot[]       @relation("TimetableSlotCreatedBy")
  updatedTimetableSlots       TimetableSlot[]       @relation("TimetableSlotUpdatedBy")
  /// AttendanceRecord
  createdAttendanceRecords    AttendanceRecord[]    @relation("AttendanceRecordCreatedBy")
  updatedAttendanceRecords    AttendanceRecord[]    @relation("AttendanceRecordUpdatedBy")
  /// MonthlyAttendanceRate
  createdMonthlyAttendanceRates MonthlyAttendanceRate[] @relation("MonthlyAttendanceRateCreatedBy")
  updatedMonthlyAttendanceRates MonthlyAttendanceRate[] @relation("MonthlyAttendanceRateUpdatedBy")
  /// SemiannualAttendanceReport
  createdSemiannualAttendanceReports SemiannualAttendanceReport[] @relation("SemiannualAttendanceReportCreatedBy")
  updatedSemiannualAttendanceReports SemiannualAttendanceReport[] @relation("SemiannualAttendanceReportUpdatedBy")
  /// BillingItem
  createdBillingItems         BillingItem[]         @relation("BillingItemCreatedBy")
  updatedBillingItems         BillingItem[]         @relation("BillingItemUpdatedBy")
  /// Invoice
  createdInvoices             Invoice[]             @relation("InvoiceCreatedBy")
  updatedInvoices             Invoice[]             @relation("InvoiceUpdatedBy")
  /// Payment
  createdPayments             Payment[]             @relation("PaymentCreatedBy")
  updatedPayments             Payment[]             @relation("PaymentUpdatedBy")
  /// MonthlyBalance
  createdMonthlyBalances      MonthlyBalance[]      @relation("MonthlyBalanceCreatedBy")
  updatedMonthlyBalances      MonthlyBalance[]      @relation("MonthlyBalanceUpdatedBy")
  /// Agent
  createdAgents               Agent[]               @relation("AgentCreatedBy")
  updatedAgents               Agent[]               @relation("AgentUpdatedBy")
  /// AgentAlias
  createdAgentAliases         AgentAlias[]          @relation("AgentAliasCreatedBy")
  updatedAgentAliases         AgentAlias[]          @relation("AgentAliasUpdatedBy")
  /// AgentInvoice
  createdAgentInvoices        AgentInvoice[]        @relation("AgentInvoiceCreatedBy")
  updatedAgentInvoices        AgentInvoice[]        @relation("AgentInvoiceUpdatedBy")
  /// AgentPayment
  createdAgentPayments        AgentPayment[]        @relation("AgentPaymentCreatedBy")
  updatedAgentPayments        AgentPayment[]        @relation("AgentPaymentUpdatedBy")
  /// Dormitory
  createdDormitories          Dormitory[]           @relation("DormitoryCreatedBy")
  updatedDormitories          Dormitory[]           @relation("DormitoryUpdatedBy")
  /// DormitoryAssignment
  createdDormitoryAssignments DormitoryAssignment[] @relation("DormitoryAssignmentCreatedBy")
  updatedDormitoryAssignments DormitoryAssignment[] @relation("DormitoryAssignmentUpdatedBy")
  /// DormitoryUtility
  createdDormitoryUtilities   DormitoryUtility[]    @relation("DormitoryUtilityCreatedBy")
  updatedDormitoryUtilities   DormitoryUtility[]    @relation("DormitoryUtilityUpdatedBy")
  /// WifiDevice
  createdWifiDevices          WifiDevice[]          @relation("WifiDeviceCreatedBy")
  updatedWifiDevices          WifiDevice[]          @relation("WifiDeviceUpdatedBy")
  /// ImmigrationTask
  createdImmigrationTasks     ImmigrationTask[]     @relation("ImmigrationTaskCreatedBy")
  updatedImmigrationTasks     ImmigrationTask[]     @relation("ImmigrationTaskUpdatedBy")
  /// ImmigrationDocument
  createdImmigrationDocuments ImmigrationDocument[] @relation("ImmigrationDocumentCreatedBy")
  updatedImmigrationDocuments ImmigrationDocument[] @relation("ImmigrationDocumentUpdatedBy")
  /// ScheduledReport
  createdScheduledReports     ScheduledReport[]     @relation("ScheduledReportCreatedBy")
  updatedScheduledReports     ScheduledReport[]     @relation("ScheduledReportUpdatedBy")
  /// DocumentTemplate
  createdDocumentTemplates    DocumentTemplate[]    @relation("DocumentTemplateCreatedBy")
  updatedDocumentTemplates    DocumentTemplate[]    @relation("DocumentTemplateUpdatedBy")
  /// RecruitmentCycle
  createdRecruitmentCycles    RecruitmentCycle[]    @relation("RecruitmentCycleCreatedBy")
  updatedRecruitmentCycles    RecruitmentCycle[]    @relation("RecruitmentCycleUpdatedBy")
  /// ApplicationCase
  createdApplicationCases     ApplicationCase[]     @relation("ApplicationCaseCreatedBy")
  updatedApplicationCases     ApplicationCase[]     @relation("ApplicationCaseUpdatedBy")
  /// ApplicationDocument
  createdApplicationDocuments ApplicationDocument[] @relation("ApplicationDocumentCreatedBy")
  updatedApplicationDocuments ApplicationDocument[] @relation("ApplicationDocumentUpdatedBy")
  /// DocumentCheckResult
  createdDocumentCheckResults DocumentCheckResult[] @relation("DocumentCheckResultCreatedBy")
  /// Company
  createdCompanies            Company[]             @relation("CompanyCreatedBy")
  updatedCompanies            Company[]             @relation("CompanyUpdatedBy")
  /// SswCase
  createdSswCases             SswCase[]             @relation("SswCaseCreatedBy")
  updatedSswCases             SswCase[]             @relation("SswCaseUpdatedBy")
  /// CaseDocument
  createdCaseDocuments        CaseDocument[]        @relation("CaseDocumentCreatedBy")
  updatedCaseDocuments        CaseDocument[]        @relation("CaseDocumentUpdatedBy")
  /// SupportPlan
  createdSupportPlans         SupportPlan[]         @relation("SupportPlanCreatedBy")
  updatedSupportPlans         SupportPlan[]         @relation("SupportPlanUpdatedBy")
  /// SswInvoice
  createdSswInvoices          SswInvoice[]          @relation("SswInvoiceCreatedBy")
  updatedSswInvoices          SswInvoice[]          @relation("SswInvoiceUpdatedBy")
  /// Skill
  createdSkills               Skill[]               @relation("SkillCreatedBy")
  updatedSkills               Skill[]               @relation("SkillUpdatedBy")
  /// SkillTaskTemplate
  createdSkillTaskTemplates   SkillTaskTemplate[]   @relation("SkillTaskTemplateCreatedBy")
  updatedSkillTaskTemplates   SkillTaskTemplate[]   @relation("SkillTaskTemplateUpdatedBy")
  /// Project
  createdProjects             Project[]             @relation("ProjectCreatedBy")
  updatedProjects             Project[]             @relation("ProjectUpdatedBy")
  /// ProjectTask
  createdProjectTasks         ProjectTask[]         @relation("ProjectTaskCreatedBy")
  updatedProjectTasks         ProjectTask[]         @relation("ProjectTaskUpdatedBy")

  @@index([createdById])
  @@index([updatedById])
  @@map("staffs")
}

/// 教員資格
model TeacherQualification {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  /// 教職員ID
  staffId           String            @db.Uuid
  /// 資格種別
  qualificationType QualificationType
  /// 取得日
  acquiredDate      DateTime?         @db.Date
  /// 有効期限（登録日本語教師の場合に該当）
  expirationDate    DateTime?         @db.Date
  /// 備考
  notes             String?
  /// 作成者スタッフID
  createdById       String?           @db.Uuid
  /// 更新者スタッフID
  updatedById       String?           @db.Uuid
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  /// 所属教職員
  staff     Staff  @relation(fields: [staffId], references: [id], onDelete: Cascade)
  /// 作成者
  createdBy Staff? @relation("TeacherQualificationCreatedBy", fields: [createdById], references: [id], onDelete: Restrict)
  /// 更新者
  updatedBy Staff? @relation("TeacherQualificationUpdatedBy", fields: [updatedById], references: [id], onDelete: Restrict)

  @@index([staffId])
  @@index([createdById])
  @@index([updatedById])
  @@map("teacher_qualifications")
}
