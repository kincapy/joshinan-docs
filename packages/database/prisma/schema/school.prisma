/// =============================================
/// 学校基本情報 (01-school-info)
/// =============================================

/// 法人種別
enum CorporateType {
  SCHOOL_CORPORATION /// 学校法人
  STOCK_COMPANY      /// 株式会社
  OTHER              /// その他
}

/// 適正校分類
enum AccreditationClass {
  CLASS_I        /// クラスI（在籍管理優良校）
  CLASS_II       /// クラスII（適正校）
  NON_ACCREDITED /// 非適正校
}

/// 入学月（4値版。募集業務では4月・10月のみだがアプリ側で制御）
enum EnrollmentMonth {
  APRIL   /// 4月（在籍期間24ヶ月）
  OCTOBER /// 10月（在籍期間18ヶ月）
  JANUARY /// 1月（在籍期間15ヶ月）
  JULY    /// 7月（在籍期間21ヶ月）
}

/// 学校
model School {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  /// 学校名
  name               String             @unique
  /// 学校番号（入管から配布された3桁の番号）
  schoolCode         String             @unique
  /// 所在地
  address            String
  /// 電話番号
  phone              String?
  /// 運営法人名
  corporateName      String
  /// 法人種別
  corporateType      CorporateType
  /// 適正校分類（毎年の判定で更新される）
  accreditationClass AccreditationClass
  /// 告示番号（認定日本語教育機関への移行後は認定番号）
  notificationNumber String?
  /// 定員数（入管に届け出た収容定員）
  capacity           Int
  /// 設立年月日
  establishedDate    DateTime           @db.Date
  /// 有効フラグ（論理削除用）
  isActive           Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  /// 入学時期マスタ
  enrollmentPeriods EnrollmentPeriod[]

  @@map("schools")
}

/// 入学時期（年度ごとの入学時期と募集定員）
model EnrollmentPeriod {
  id                  String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  /// 学校ID
  schoolId            String          @db.Uuid
  /// 入学月
  enrollmentMonth     EnrollmentMonth
  /// 在籍期間（月数）
  durationMonths      Int
  /// 年度（西暦）
  fiscalYear          Int
  /// 募集定員
  recruitmentCapacity Int
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  /// 所属学校
  school School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([schoolId, enrollmentMonth, fiscalYear])
  @@index([schoolId])
  @@map("enrollment_periods")
}
