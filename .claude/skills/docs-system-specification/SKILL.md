---
name: docs-system-specification
description: システム仕様のドキュメント作成・更新スキル。/docs-system-specification で呼び出し、domain-knowledge を元に 01-entity.md / 02-uiux.md を順番に作成する。エンティティ定義、UIUX設計の策定に使用する。
---

# System Specification ドキュメンテーションスキル

`docs/02-system-specification/` 配下のシステム仕様を作成・更新する手順スキル。
内容規約は `docs/02-system-specification/README.md` を参照。

## 起動時の処理

### 1. カテゴリとソースの把握

まず以下を確認する:

- `docs/02-system-specification/` 配下の既存カテゴリを一覧
- `docs/01-domain-knowledge/` 配下の対応するカテゴリを特定
- 対応する domain-knowledge の `02-data.md` / `01-work-flow.md` / `03-issues.md` を読み込む

### 2. ユーザーへの確認

`AskUserQuestion` を使い、以下を確認する:

- **対象カテゴリ**: どのカテゴリの仕様を作成/更新するか
- **作業範囲**: どのステップまで進めるか
  - 01-entity.md のみ
  - 01-entity.md + 02-uiux.md（フル）
- **domain-knowledge の確認**: 対応する domain-knowledge が存在し、十分な内容があるか

### 3. domain-knowledge の確認

対応する domain-knowledge ファイルを読み込み、**内容が十分か**を判断する:

- `02-data.md` が空 → エンティティ定義に進めない旨を伝え、domain-knowledge スキルの使用を提案
- `01-work-flow.md` が空 → UIUX定義の精度が落ちる旨を伝える
- `03-issues.md` が空 → 課題解決の観点が欠ける旨を伝える

内容が不十分な場合、**先に domain-knowledge スキルで補完すべきかユーザーに確認**する。

### 4. 新規カテゴリの場合

ディレクトリと空ファイルを作成する:

```
docs/02-system-specification/{NN-category}/
├── index.md              # カテゴリラベル
├── 01-entity.md          # エンティティ定義
└── 02-uiux.md            # UIUX定義
```

**番号プレフィックス**: カテゴリディレクトリには既存カテゴリの連番に合わせた `NN-` プレフィックスを付ける。

**VitePress サイドバー**: 新規カテゴリを作成した場合、`docs/.vitepress/config.ts` のサイドバー定義に手動でエントリを追加すること。各ドキュメントファイルには frontmatter `title` を設定する。

```markdown
<!-- index.md -->
---
title: 車両管理
---

# 車両管理
```

## ステップ1: エンティティ定義 (01-entity.md)

`02-data.md` を元に、エンティティの定義を行う。

### ユーザーへの確認事項

- データ型の判断が曖昧な項目はないか
- nullable な項目はどれか
- unique 制約が必要な項目はどれか
- エンティティ間のリレーション（1:N, N:N など）

### 記述フォーマット

```markdown
---
title: エンティティ定義
---

# {カテゴリ} エンティティ定義

## {エンティティ名} / {EntityName}

{エンティティの説明}

| プロパティ | 英語名 | 型 | デフォルト | nullable | unique | 制約・バリデーション |
|-----------|--------|-----|-----------|----------|--------|---------------------|
| ID | id | UUID | auto | - | o | PK |
| {項目} | {name} | {type} | {default} | {o/-} | {o/-} | {制約} |

### リレーション

- {EntityName} → {OtherEntity}: {関係の説明} (1:N / N:1 / 1:1 / N:N)
```

### データ型の選定基準

| 業務データ | 推奨型 | 備考 |
|-----------|--------|------|
| 識別子 | UUID | id, 外部キー |
| 名前・テキスト(短) | String | min/max制約付き |
| テキスト(長) | String | memo, description |
| 整数 | Int | 数量、回数 |
| 小数 | Float / Decimal | 金額はDecimal推奨 |
| 日付 | Date | 年月日のみ |
| 日時 | DateTime | タイムスタンプ |
| 真偽 | Boolean | フラグ |
| 選択肢 | Enum | Value Object として定義 |

## ステップ2: UIUX定義 (02-uiux.md)

`01-work-flow.md` と `03-issues.md` を元に、UIUXの定義を行う。

### ユーザーへの確認事項

- 画面の一覧と各画面の役割
- 画面遷移の流れ
- 一覧画面のフィルタ・ソート・ページネーション
- フォームのフィールド構成
- 状態管理（表示モード、ステータス切替など）

### 記述フォーマット

```markdown
---
title: UIUX定義
---

# {カテゴリ} UIUX定義

## 操作フロー

### 画面一覧

| 画面名 | パス | 役割 |
|--------|------|------|
| {画面名} | /{path} | {役割の説明} |

### 画面遷移

{画面遷移のフローを記述}

## 画面定義

### {画面名}

#### 表示内容

- 参照エンティティ: {EntityName}
  - 表示プロパティ: {property1}, {property2}, ...
- フィルタ: {フィルタ条件}
- ソート: {ソート条件}
- ページネーション: {あり/なし}

#### フォーム内容（該当する場合）

| フィールド | 型 | 必須 | バリデーション | 備考 |
|-----------|-----|------|---------------|------|
| {フィールド名} | {input type} | {o/-} | {ルール} | {補足} |

- 送信後の遷移: {遷移先}
- 送信後の状態変更: {状態変更の説明}

## アルゴリズム

### {アルゴリズム名}

- 利用箇所: {画面表示時 / フォーム送信時}
- 処理内容: {処理の説明}
- 副作用: {他データへの影響}
```

## 対話のルール

- 各ステップの完了時にユーザーに**レビューと承認**を求める
- `01-entity.md` が承認されてから `02-uiux.md` に進む
- domain-knowledge と矛盾がある場合は**ユーザーに確認**してから進める
- 実装計画では**コードサンプルは原則不要**。ファイル一覧と簡潔な説明で十分
- 特殊なアルゴリズムや既存パターンにない実装がある場合のみ、詳細を記述する

## 完了時の処理

1. 作成・更新したファイルの内容をユーザーに提示する
2. **相互参照の整合性チェック**を実施する:
   - 更新したファイルのパスで `docs/` 配下を検索し、参照元・参照先を特定する
   - 以下の参照関係を確認し、不整合がないかチェックする:

   | 変更したファイル | 確認すべき参照先 |
   |----------------|----------------|
   | `01-entity.md` | 同カテゴリの `02-uiux.md` |
   | `02-uiux.md` | `docs/03-tasks/` 配下の関連タスクファイル |

   - 確認ポイント:
     - エンティティ名・プロパティ名の変更が他ドキュメントに反映されているか
     - 画面定義の変更が実装計画に反映されているか
     - リンク切れが発生していないか
   - 不整合がある場合はユーザーに報告し、修正するか確認する
3. **VitePress サイドバー更新**: 新規ファイル・カテゴリを追加した場合、`docs/.vitepress/config.ts` のサイドバー定義を更新する
4. 次のステップについて確認する:
   - `docs-tasks` スキルでタスクを作成し、実装に進むか？
   - ドキュメントの修正が必要か？
   - 一旦ここで終了するか？
